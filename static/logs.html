<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momo Logs Viewer</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.active {
            background: #28a745;
        }
        .log-container {
            background: #000;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            height: 600px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
        }
        .log-line {
            margin-bottom: 2px;
            word-wrap: break-word;
        }
        .log-line.error {
            color: #ff4444;
        }
        .log-line.warning {
            color: #ffaa00;
        }
        .log-line.info {
            color: #00ff00;
        }
        .log-line.debug {
            color: #888;
        }
        .status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        input[type="checkbox"] {
            margin: 0;
        }
        select, input[type="number"] {
            background: #2a2a2a;
            color: #00ff00;
            border: 1px solid #444;
            padding: 4px 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Momo Assistant - Logs Viewer</h1>
            <p>Real-time application logs monitoring</p>
        </div>

        <div class="controls">
            <button class="btn active" onclick="switchLog('app')" id="btn-app">App Logs</button>
            <button class="btn" onclick="switchLog('errors')" id="btn-errors">Error Logs</button>
            <button class="btn" onclick="switchLog('gmail')" id="btn-gmail">Gmail API Logs</button>
            
            <select id="lines-select" onchange="refreshLogs()">
                <option value="50">Last 50 lines</option>
                <option value="100" selected>Last 100 lines</option>
                <option value="200">Last 200 lines</option>
                <option value="500">Last 500 lines</option>
            </select>
            
            <button class="btn" onclick="refreshLogs()">üîÑ Refresh</button>
            <button class="btn" onclick="clearLogs()">üóëÔ∏è Clear Display</button>
        </div>

        <div class="status">
            <div>
                <span id="log-info">Loading logs...</span>
            </div>
            <div class="auto-refresh">
                <input type="checkbox" id="auto-refresh" onchange="toggleAutoRefresh()">
                <label for="auto-refresh">Auto-refresh (5s)</label>
            </div>
        </div>

        <div class="log-container" id="log-container">
            <div class="log-line">Loading logs...</div>
        </div>
    </div>

    <script>
        let currentLogType = 'app';
        let autoRefreshInterval = null;

        function switchLog(logType) {
            currentLogType = logType;
            
            // Update button states
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${logType}`).classList.add('active');
            
            refreshLogs();
        }

        async function refreshLogs() {
            const lines = document.getElementById('lines-select').value;
            const container = document.getElementById('log-container');
            const info = document.getElementById('log-info');
            
            try {
                info.textContent = 'Loading...';
                
                const response = await fetch(`/logs?log_type=${currentLogType}&lines=${lines}`);
                const data = await response.json();
                
                if (data.error) {
                    container.innerHTML = `<div class="log-line error">Error: ${data.error}</div>`;
                    info.textContent = 'Error loading logs';
                    return;
                }

                if (data.logs.length === 0) {
                    container.innerHTML = `<div class="log-line">No logs found for ${currentLogType}</div>`;
                    info.textContent = `No ${currentLogType} logs`;
                    return;
                }

                // Display logs
                container.innerHTML = data.logs.map(line => {
                    let className = 'log-line';
                    if (line.includes('ERROR')) className += ' error';
                    else if (line.includes('WARNING')) className += ' warning';
                    else if (line.includes('INFO')) className += ' info';
                    else if (line.includes('DEBUG')) className += ' debug';
                    
                    return `<div class="${className}">${escapeHtml(line)}</div>`;
                }).join('');

                // Auto-scroll to bottom
                container.scrollTop = container.scrollHeight;

                // Update info
                info.textContent = `${data.returned_lines} of ${data.total_lines} lines | Last updated: ${new Date().toLocaleTimeString()}`;

            } catch (error) {
                container.innerHTML = `<div class="log-line error">Failed to load logs: ${error.message}</div>`;
                info.textContent = 'Connection error';
            }
        }

        function clearLogs() {
            document.getElementById('log-container').innerHTML = '<div class="log-line">Logs cleared. Click refresh to reload.</div>';
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh');
            
            if (checkbox.checked) {
                autoRefreshInterval = setInterval(refreshLogs, 5000);
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            refreshLogs();
        });
    </script>
</body>
</html>